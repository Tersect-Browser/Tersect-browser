<div class="v-stretch-box">
    <div class="tb-top-bar">
        <button pButton class="tb-setting-button" icon="fa fa-database"
        (click)="display_sidebar = true" ></button>
        <img class="tb-logo" src="assets/logo.png" />
        <a href="https://www.cranfield.ac.uk/" target="_blank">
            <img class="cranfield-logo" src="assets/cranfield_logo.png" />
        </a>
    </div>

    <div class="p-grid p-justify-between tb-toolbar p-nogutter">
        <p-toggleButton [(ngModel)]="display_tree"
                        [style]="{'width': '2em', 'margin-top': '1em'}"
                        onLabel="" offLabel=""
                        offIcon="fa fa-tree"
                        onIcon="fa fa-tree"></p-toggleButton>
        <div class="p-col accession-selector tb-toolbar-control">
            <div class="dropdown-label">Reference</div>
            <p-dropdown [options]="accessions"
                        [filter]="true"
                        [autoWidth]="false"
                        [style]="{'width':'100%'}"
                        [(ngModel)]="selected_reference"></p-dropdown>
        </div>
        <div class="p-col tb-toolbar-control">
            <div class="dropdown-label">Chromosome</div>
            <p-dropdown [options]="chromosomes"
                        [style]="{'width':'100%'}"
                        [(ngModel)]="selected_chromosome"></p-dropdown>
        </div>
        <div class="p-col interval-selector tb-toolbar-control">
            <div class="interval-label">
                Interval:
                <input class="interval-input" type="text" pKeyFilter="pint"
                    [(ngModel)]="selected_interval[0]"
                    (input)="typeInterval($event)" pInputText>
                -
                <input class="interval-input" type="text" pKeyFilter="pint"
                    [(ngModel)]="selected_interval[1]"
                    (input)="typeInterval($event)" pInputText>
            </div>
            <div class="interval-slider">
                <p-slider [(ngModel)]="selected_interval" [range]="true"
                          [animate]="true"
                          [style]="{'width':'100%'}"
                          (onChange)="intervalSliderChange($event)"
                          (onSlideEnd)="updateInterval()"
                          [min]="interval_min" [max]="interval_max"></p-slider>
            </div>
        </div>
        <div class="p-col binsize-selector tb-toolbar-control">
            <div class="slider-label">Bin size: {{ widget_binsize }}</div>
            <div class="binsize-slider">
                <p-slider [(ngModel)]="widget_binsize"
                          [animate]="true"
                          [style]="{'width':'100%'}"
                          [min]="binsize_min" [max]="binsize_max"
                          [step]="binsize_step"
                          (onChange)="binsizeSliderChange($event)"
                          (onSlideEnd)="updateBinsize()"></p-slider>
            </div>
        </div>
        <div class="p-col zoom-selector tb-toolbar-control">
            <button pButton icon="fa fa-search-minus"
                    [disabled]="zoom_level <= MIN_ZOOM_LEVEL"
                    (click)="zoomOut()"></button>
            <button pButton icon="fa fa-search-plus"
                    [disabled]="zoom_level >= MAX_ZOOM_LEVEL"
                    (click)="zoomIn()"></button>
        </div>
        <div class="p-col toolbar-buttons tb-toolbar-control">
            <button pButton label="Download" icon="fa fa-download"
                disabled="true">
            </button>
            <button pButton label="Share" icon="fa fa-external-link"
                disabled="true">
            </button>
        </div>
    </div>

    <div #plotContainer class="v-stretch plot-container hbox">
        <app-introgression-plot
            [drawTree]="display_tree"
            [chromosome]="selected_chromosome"
            [accessions]="selected_accessions"
            [interval]="selected_interval"
            [reference]="selected_reference"
            [binsize]="selected_binsize"
            [zoom_level]="zoom_level"
            (plotClick)="plotClick($event)"
            (plotHover)="tooltip.show($event)"
            (wheel)="scrollWheel($event)"
            (mousemove)="tooltip.hide()"
            (mouseleave)="tooltip.hide()">
        </app-introgression-plot>

        <app-plot-click-menu
            (setReference)="setReference($event)"
            (removeAccession)="removeAccession($event)"
            (setIntervalStart)="setIntervalStart($event)"
            (setIntervalEnd)="setIntervalEnd($event)">
        </app-plot-click-menu>

        <app-tooltip></app-tooltip>

    </div>
</div>

<p-sidebar [(visible)]="display_sidebar" position="left"
           (onHide)="updateAccessions()">
    <b>Displayed accessions</b>
    <p-listbox [options]="accessions" [(ngModel)]="widget_accessions"
               filter="true" multiple="true" checkbox="true"
               [style]="{'width': '100%', 'height': '95%'}"
               [listStyle]="{'max-height':'100%'}">
    </p-listbox>
</p-sidebar>
